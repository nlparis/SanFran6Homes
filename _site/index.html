<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Home | SanFran6Homes</title>
<meta property="og:title" content="Home" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="There are at least 6 homes you may stay in in San Francisco (for a few nights, probably.) This web app will help you find one (probably.)" />
<meta property="og:description" content="There are at least 6 homes you may stay in in San Francisco (for a few nights, probably.) This web app will help you find one (probably.)" />
<link rel="canonical" href="http://localhost:4000/" />
<meta property="og:url" content="http://localhost:4000/" />
<meta property="og:site_name" content="SanFran6Homes" />
<script type="application/ld+json">
{"name":"SanFran6Homes","description":"There are at least 6 homes you may stay in in San Francisco (for a few nights, probably.) This web app will help you find one (probably.)","author":null,"@type":"WebSite","url":"http://localhost:4000/","publisher":null,"image":null,"headline":"Home","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link href="/assets/css/style.css?v=99e935d55d07c055eb80c0e67e821d320f98fe6b" rel="stylesheet">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
        <h1><a href="http://localhost:4000/">SanFran6Homes</a></h1>
      

      <div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.8.3/jquery.csv.js"></script>
        <script>
        var data;
        $.ajax({
            type: "GET",
            url: "listings.csv",
            dataType: "text",
            success: function(response)
            {
                data = $.csv.toArrays(response);
                //generateHtmlTable(data);
            }
        });

//        test function
        function generateHtmlTable(data) {
            var html = '<table  class="table table-condensed table-hover table-striped">';

            if(typeof(data[0]) === 'undefined') {
                return null;
            } else {
                var counter = 0;
                $.each(data, function( index, row ) {
                    //bind header
                    if(index == 0) {
                        html += '<thead>';
                        html += '<tr>';
                        $.each(row, function( index, colData ) {
                            html += '<th>';
                            html += colData;
                            html += '</th>';
                        });
                        html += '</tr>';
                        html += '</thead>';
                        html += '<tbody>';
                    } else {
                        html += '<tr>';
                        $.each(row, function( index, colData ) {
                            html += '<td>';
                            html += colData;
                            html += '</td>';
                        });
                        html += '</tr>';
                    }
                    if (counter > 50){
                        return false;
                    } else {
                        counter++;
                    }
                });
                html += '</tbody>';
                html += '</table>';
                alert(html);
                $('#csv-display').append(html);
            }
        }
        </script>
    <h1>Hi there, welcome to 6Homes!</h1>
    <ul>
        <li>This is the site.</li>
    </ul>
    <div>
        <!--display first graph: price per person map-->
        <!--<a href="https://plot.ly/~nlparis/6/?share_key=FZPFSbz3bCwvNwxNItdMlm" target="_blank" title="Plot 6" style="display: block; text-align: center;"><img src="https://plot.ly/~nlparis/6.png?share_key=FZPFSbz3bCwvNwxNItdMlm" alt="Plot 6" style="max-width: 100%;width: 600px;"  width="600" onerror="this.onerror=null;this.src='https://plot.ly/404.png';" /></a>-->
        <!--<script data-plotly="nlparis:6" sharekey-plotly="FZPFSbz3bCwvNwxNItdMlm" src="https://plot.ly/embed.js" async></script>-->
    </div>
    <div id="csv-display"></div>
    <p> Price Estimation:</p>
    Latitude: <input type="text" id="latitude">
    Longitude: <input type="text" id="longitude">
    <input type="button" value="Estimate Weekly Earnings at this location" onClick="priceEstimation()">
    <div class="loading" style="display:none">loading...</div>
    <div class="estimatedPrice" style="display:none"></div>

    <script>
        function priceEstimation(){
            $(".loading").show();
            $(".estimatedPrice").show();
            var latitude = $("#latitude").val();
            var longitude = $("#longitude").val();

            //check ranges of latitude/longitude based on listing.csv data
            //min(most south) latitude: 37.7069277
            //max(most north) latitude: 37.8310804
            //min(most east) longitude: -122.3647732
            //min(most west) longitude: -122.5115

            if (latitude > 37.8310804 || latitude < 37.7069277 || longitude < -122.5115 || longitude > -122.3647732){
                window.alert("You have chosen a location out of range. Please narrow your search to be closer to San Francisco (37.773972, -122.431297)");
                //Ranges defined from data in avg_prices.csv
                //(which was retrieved from data in weekly_price.csv which got its data from listings.csv)
                //San Francisco coordinates defined from https://www.latlong.net/place/san-francisco-ca-usa-594.html
                $(".loading").hide();
                return;
            }

            var listing_data;
            $.ajax({
                type: "GET",
                url: "avg_prices.csv",
                dataType: "text",
                success: function (response) {
                    data = $.csv.toArrays(response);

                    //shortenData(listing_data);
                    var length = data.length;

                    var area_array = [];//let javascript know this is an array

                    var proximity = 0;
                    while (area_array.length == 0) {
                        proximity += 0.001;
                        //console.log("proximity is " + proximity);
                        //A 0.01 change in latitude/longitude is about 0.7 miles
                        //we are doing about 1/10 of that

                        for (var i = 1; i < length; ++i) {
                            //start at i=1 so we dont get column headers

                            //0.005 is my decided range for proximity
                            if (Math.abs(Math.abs(data[i][2]) - Math.abs(latitude)) <= proximity) { //2 corresponds to latitude
                                if (Math.abs(Math.abs(data[i][3]) - Math.abs(longitude)) <= proximity) {//3 corresponds to longitude
                                    area_array.push(parseInt(data[i][4]));
                                }
                            }
                        }
                    }
                    //at this point we have an array of prices that approximately fit the specified location

                    //loop through to find the average.
                    var avg = 0;
                    for (var i = 0; i < area_array.length; ++i){
                        avg += area_array[i];
                    }

                    //I coded my c++ (which makes the avg_prices.csv to extrapolate
                    // prices for every location, but this causes very low averages.
                    // We will perform two more loops, one using values strictly above
                    // this calculated average, and the other averaging that.
                    //This way, our data is more accurate and extrapolated decently.

                    avg = avg/area_array.length;

                    var second_area_array = [];
                    for (var i = 0; i < area_array.length; ++i){
                        if (area_array[i] > avg){
                            second_area_array.push(parseInt(area_array[i]));
                        }
                    }

                    avg = 0;
                    for (var i = 0; i < second_area_array.length; ++i){
                        avg += second_area_array[i];
                    }

                    avg = avg/second_area_array.length;

                    //since we cleared the "hazy" values, this is now a much better estimation!

                    $(".loading").hide();
                    $(".estimatedPrice").empty();
                    $(".estimatedPrice").append("Estimated Weekly Income (minus cleaning fees) in this area: $" + avg.toFixed(2));
                    $(".estimatedPrice").show();
                }
            });
        }

    </script>
</div>


      
    </div>
    <script src="/assets/javascript/anchor-js/anchor.min.js"></script>
    <script>anchors.add();</script>
  </body>
</html>
